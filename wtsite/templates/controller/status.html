{% extends "base.html" %}

{% load controller_extras %}

{% block title %}
   Washtub Liquidsoap Controller - Status
{% endblock title %}
{% block tabsetup %}
	$('#tabs').tabs();
{% endblock tabsetup %}
{% block content %}<div id="tabs">
			    <ul>
			    	<li><a href="#tabs-1">Status</a></li>
			    	<li><a href="{% url controller.views.display_queues active_host %}">Queues</a></li>
			    	<li><a href="#tabs-3">Pool</a></li>
			    	<li><a href="{% url controller.views.display_history active_host %}">History</a></li>
			    	<li><a href="#tabs-5">Help</a></li>
			    </ul>
			    <div id="tabs-1">
			    	  <div id="rightside">
			    	  <table id="nodeTable" class="tablesorter">
			    	  <thead>
			    	  <tr><td>Node List</td><td>Type</td></tr>
			    	  </thead>
			    	  <tbody>
			    	  {% for item,type in node_list.items %}
			    	  <tr><td>{{ item|replacedot }}</td><td>{{ type }}</td></tr>
			    	  {% endfor %}
			    	  <tfoot colspan="2"><tr><td></td></tr></tfoot>
			    	  </tbody>
			    	  </table>
			    	  </div>	
			    	  <div id="controls">
					  {% for name in streams %}
			    	  	{% if forloop.counter0|divisibleby:2 %}
			    	  		{% if not forloop.first %}
			    	  		</div><div id="controls">
			    	  		{% endif %}
			    	  	{% endif %}
			    	  	<table id="streamTable" class="tablesorter">
			    	  	<thead>
			    	  	{% with status.base_url|cat:name|cat:".m3u"|replacedot as stream_url %}
			    	  	<tr><td colspan="2"><a href="{{ stream_url }}" title="Listen to {{ name|replacedot }}">{{ name|replacedot }}</a></td></tr>
			    	  	{% endwith %}
			    	  	</thead>
			    	  	<tbody>
			    	  	{% for item, info in status.items %}
			    	  		{% with name|cat:".status" as info_command %}
			    	  		{% ifequal info_command item %}
			    	  			<tr><td>Status:</td>
			    	  			{% ifequal info "on" %}
			    	  			<td class="statuson" colspan="2">
			    	  			<div title="{{ name|replacedot }} is currently playing.">
			    	  			<span id="controlspan"><strong>ON</strong></span>
			    	  			</div>
			    	  			</td>
			    	  			{% else %}
			    	  			<td class="statusoff" colspan="2">
			    	  			<div title="{{ name|replacedot }} is currently stopped."> 
			    	  			<span id="controlspan"><strong>OFF</strong></span>
			    	  			</div>
			    	  			</td>
			    	  			{% endifequal %}
			    	  			</tr>
			    	  		{% endifequal %}
			    	  		{% endwith %}
			    	  	{% endfor %}
			    	  	{% for item, info in status.items %}
			    	  		{% with name|cat:".remaining" as info_command %}
			    	  		{% ifequal info_command item %}
			    	  			<tr><td>Remaining:</td><td class="remaining" colspan="2">{{ info|tominutes }}</td></tr>
			    	  		{% endifequal %}
			    	  		{% endwith %}
			    	  	{% endfor %}
			    	  	<tr>
			    	  	<td class="play">
			    	  	<a href="{% url controller.views.stream_start active_host name %}" title="Play">
			    	  	<span id="controlspan">&nbsp;</span>
			    	  	</a>
			    	  	</td>
			    	  	<td class="stop">
			    	  	<a href="{% url controller.views.stream_stop active_host name %}" title="Stop">
			    	  	<span id="controlspan">&nbsp;</span> 
			    	  	</a>
			    	  	</td>
			    	  	<td class="skip">
			    	  	<a href="{% url controller.views.stream_skip active_host name %}" title="Skip">
			    	  	<span id="controlspan">&nbsp;</span>
			    	  	</a>
			    	  	</td>
			    	  	</tr>
			    	  	</tbody>
			    	  	</table> 
			    	  {% endfor %}
			    	  </div>
			    	  <div id="leftside">
					  {% if status %}
					  <h1>{{ status.host|upper }}</h1>
					  <div>
					  IP Address:&nbsp;{{ status.ip_address }}<br/>
					  Version:&nbsp;{{ status.version }}<br/>
					  Uptime:&nbsp;{{ status.uptime }}<br/>
					  {{ status.base_url|urlize }}<br/>
					  </div>
					  {% endif %}
					  </div>
			    	  <div class="clearingdiv">&nbsp;</div>
					  {% for name, entries in air_queue.items %}
					  	<b>Currently On Air:</b><br/>
					  	<table id="onAirTable" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					  	{% for e in entries %}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }} {% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
					  
					  {% for name, entries in alive_queue.items %}
					  	<b>Currently Alive:</b><br/>
					  	<table id="aliveTable" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					  	{% for e in entries reversed %}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }} {% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
					  
				</div>
			    <div id="tabs-2">
				</div>
			    <div id="tabs-3">
			    	  {% block pooltab %}
				    	  <form class="searchform" action="{% url controller.views.search_pool_page active_host 1 %}" method="GET">
							<input class="searchbox" type="text" name="search"></input>
							<input type="hidden" name="type" value="song"></input>
							<input class="searchbutton" type="submit" value="submit"></submit>
						 </form>
					   	  <b>Available Media(</b><i>{{ all_pages.count }} items found</i><b>):</b><br/>
					 		<table id="poolTable" class="tablesorter"> 
							<thead> 
							<tr> 
							    <th class="track">#</th> 
							    <th class="title">Title</th> 
							    <th class="artist">Artist</th> 
							    <th class="album">Album</th> 
							    <th class="genre">Genre</th>
							    <th class="lastplay">Last Played</th>
							    <th class="ops">Ops</th> 
							</tr>
					   	  	</thead>
					   	  	<tbody>
						   {% for entry in single_page.object_list %}
						 	<tr>
									<td class="track">{{ entry.track }}</td>
									<td>{{ entry.title|truncatewords:8 }}</td>
									<td>{{ entry.artist }}</td>
									<td>{{ entry.album|truncatewords:5 }}</td>
									<td>{{ entry.genre }}</td>
									{% if entry.lastplay %}
										<td>{{ listing.on_air }} {% now "T" %}</td>
									{% else %}
										<td></td>
									{% endif %}
									<td class="ops">
									<form name="queue_add_{{ entry.id }}" action="{% url controller.views.queue_push active_host %}" method="POST">
									<select name="queue" onchange="this.form.submit();">
									<option>&lt;add to queue&gt;</option>
									{% for item, type in node_list.items %}
										{% ifequal type "queue" %}
										<option value="{{ item }}">{{ item }}</option>
										{% endifequal %}
										{% ifequal type "editable" %}
										<option value="{{ item }}">{{ item }}</option>
										{% endifequal %}
									{% endfor %}
									</select>
									<input type="hidden" name="uri" value="{{ entry.id }}">
									</form>
									</td>
								</tr>
						   	{% endfor %}
					   	  	</tbody>
					   	  	</table>
					   	  	<br/>
					   	  	{% block pagination %}
					   	  	<div class="pagination"> 
								<span class="pagination-pre">
								{% if single_page.has_previous %}&larr;<a href="{% url controller.views.display_pool_page active_host "songs" single_page.previous_page_number %}">previous</a>{% endif %}
								</span>
								{% if single_page.number %}
								<span class="pagination-count">page {{ single_page.number }} of {{ single_page.paginator.num_pages }}</span>
								{% endif %}
								<span class="pagination-next">
								{% if single_page.has_next %}<a href="{% url controller.views.display_pool_page active_host "songs" single_page.next_page_number %}">next</a>&rarr;{% endif %}
								</span>
							</div>
							{% endblock pagination %}
			      {% endblock pooltab %}
				</div>
			    <div id="tabs-4">
				</div>
			    <div id="tabs-5">
				</div>
				</div>
			</div>
{% comment %}
<div id="accordion">
  <div>
	<h3><a href="#">Server Tools</a></h3>
		<div>
		    Tools.
		</div>
  </div>
  <div>
	<h3><a href="#">Second</a></h3>
		<div>Phasellus mattis tincidunt nibh.</div>
  </div>

  <div>
	<h3><a href="#">Third</a></h3>
		<div>Nam dui erat, auctor a, dignissim quis.</div>
	</div>
</div>
{% endcomment %}
{% endblock content %}