{% extends "base.html" %}
{% block title %}
   Washtub Liquidsoap Controller - Status
{% endblock title %}
{% block tabsetup %}
	$('#tabs').tabs();
{% endblock tabsetup %}
{% load controller_extras %}
{% block content %}<div id="tabs">
			    <ul>
			    	<li><a href="#tabs-1">Status</a></li>
			    	<li><a href="#tabs-2">Queues</a></li>
			    	<li><a href="#tabs-3">Pool</a></li>
			    	<li><a href="#tabs-4">History</a></li>
			    	<li><a href="#tabs-5">Help</a></li>
			    </ul>
			    <div id="tabs-1">
			    	  <div id="rightside">
			    	  <table id="nodeTable" class="tablesorter">
			    	  <thead>
			    	  <tr><td>Node List</td><td>Type</td></tr>
			    	  </thead>
			    	  <tbody>
			    	  {% for item,type in node_list.items %}
			    	  <tr><td>{{ item|replacedot }}</td><td>{{ type }}</td></tr>
			    	  {% endfor %}
			    	  <tfoot colspan="2"><tr><td></td></tr></tfoot>
			    	  </tbody>
			    	  </table>
			    	  </div>
			    	  	<div id="controls">
					  {% for name in streams %}
			    	  	<table id="streamTable" class="tablesorter">
			    	  	<thead>
			    	  	{% with status.base_url|cat:name|cat:".m3u"|replacedot as stream_url %}
			    	  	<tr><td>Control(<a href="{{ stream_url }}" title="Listen to {{ name|replacedot }}">{{ name|replacedot }}</a>):</td></tr>
			    	  	{% endwith %}
			    	  	</thead>
			    	  	<tbody>
			    	  	{% for item, info in status.items %}
			    	  		{% with name|cat:".status" as info_command %}
			    	  		{% ifequal info_command item %}
			    	  			<tr><td>Status:</td>
			    	  			{% ifequal info "on" %}
			    	  			<td class="statuson" colspan="2">
			    	  			<div title="{{ name|replacedot }} is currently playing.">
			    	  			<span id="controlspan">&nbsp;</span>
			    	  			</div>
			    	  			</td>
			    	  			{% else %}
			    	  			<td class="statusoff" colspan="2">
			    	  			<div title="{{ name|replacedot }} is currently stopped."> 
			    	  			<span id="controlspan">&nbsp;</span>
			    	  			</div>
			    	  			</td>
			    	  			{% endifequal %}
			    	  			</tr>
			    	  		{% endifequal %}
			    	  		{% endwith %}
			    	  	{% endfor %}
			    	  	{% for item, info in status.items %}
			    	  		{% with name|cat:".remaining" as info_command %}
			    	  		{% ifequal info_command item %}
			    	  			<tr><td>Remaining:</td><td class="remaining" colspan="2">{{ info|tominutes }}</td></tr>
			    	  		{% endifequal %}
			    	  		{% endwith %}
			    	  	{% endfor %}
			    	  	<tr>
			    	  	<td class="play">
			    	  	<a href="/washtub/control/start/{{ active_host }}/{{ name }}" title="Play">
			    	  	<span id="controlspan">&nbsp;</span>
			    	  	</a>
			    	  	</td>
			    	  	<td class="stop">
			    	  	<a href="/washtub/control/stop/{{ active_host }}/{{ name }}" title="Stop">
			    	  	<span id="controlspan">&nbsp;</span> 
			    	  	</a>
			    	  	</td>
			    	  	<td class="skip">
			    	  	<a href="/washtub/control/skip/{{ active_host }}/{{ name }}" title="Skip">
			    	  	<span id="controlspan">&nbsp;</span>
			    	  	</a>
			    	  	</td>
			    	  	</tr>
			    	  	</tbody>
			    	  	</table>
			    	  {% endfor %}
			    	  	</div>
			    	  <div id="leftside">
					  {% if status %}
					  <b>Host:</b>&nbsp;{{ status.host }}<br/>
					  <b>IP Address:</b>&nbsp;{{ status.ip_address }}<br/>
					  <b>Version:</b>&nbsp;{{ status.version }}<br/>
					  <b>Uptime:</b>&nbsp;{{ status.uptime }}<br/>
					  <b>URL:</b>&nbsp;{{ status.base_url|urlize }}<br/>
					  {% endif %}
					  </div>
			    	  <div class="clearingdiv">&nbsp;</div>
					  {% for name, entries in air_queue.items %}
					  	<b>Currently On Air:</b><br/>
					  	<table id="onAirTable" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					  	{% for e in entries %}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }} {% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
					  
					  {% for name, entries in alive_queue.items %}
					  	<b>Currently Alive:</b><br/>
					  	<table id="aliveTable" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					  	{% for e in entries reversed %}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }} {% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
					  
				</div>
			    <div id="tabs-2">
			       {% if queue %}
					  {% for name, entries in queue.items %}
					  	<b>Queue({{ name }}):</b><br/>
					  	<table id="metaTable{{ forloop.counter0 }}" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
			      	  	{% if entries %}
					  	{% for e in entries %}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }}{% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	{% else %}
			      	  	<tr><td colspan="7">There are no items in this queue to display.</td></tr>
			      	  	{% endif %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
				  {% else %}
					 <div class="ui-widget">
						<div class="ui-state-highlight ui-corner-all" style="padding: 0 .7em;"> 
							<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span> 
							<strong>Notice:</strong> See 'Status -> Node List' for a list of existing queues. Queue names must be configured for display.</p>
						</div>
					 </div>
				  {% endif %}
				</div>
			    <div id="tabs-3">
			    	  {% block pooltab %}
			      	  <b>Available Media:</b><br/>
					  	<table id="poolTable" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="track">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="genre">Genre</th>
						    <th class="lastplay">Last Played</th>
						    <th class="ops">Ops</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					    {% for entry in single_page.object_list %}
					  	<tr>
		  					<td>{{ entry.track }}</td>
		  					<td>{{ entry.title|truncatewords:8 }}</td>
		  					<td>{{ entry.artist }}</td>
		  					<td>{{ entry.album|truncatewords:5 }}</td>
		  					<td>{{ entry.genre }}</td>
		  					{% if entry.lastplay %}
		  						<td>{{ listing.on_air }} {% now "T" %}</td>
		  					{% else %}
		  						<td></td>
		  					{% endif %}
		  					<td class="ops">
		  					<select id="uriInstance" onchange="PutQueueRequest({{ entry.id }})">
		  					{% for item, type in node_list.items %}
		  						<option><add to queue></option>
		  						{% ifequal type "request" %}
		  						<option>{{ item }}</option>
		  						{% endifequal %}
		  						{% ifequal type "editable" %}
		  						<option>{{ item }}</option>
		  						{% endifequal %}
		  					{% endfor %}
		  					</select>
		  					<form name="queue_add" action="/washtub/queue/push/{{ active_host }}/request" method="POST">
		  					<input type="hidden" name="uri" value="{{ entry.id }}">
		  					<input type="submit" value="add"></input>
		  					</form>
		  					</td>
		  				</tr>
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
			      	  	 <div class="pagination"> 
   							<span class="pagination-pre">
   							{% if single_page.has_previous %}&larr;<a href="/washtub/pool/{{active_host}}/songs/{{single_page.previous_page_number}}">previous</a>{% endif %}
   							</span>
   							{% if single_page.number %}
   							<span class="pagination-count">page {{ single_page.number }} of {{ single_page.paginator.num_pages }}</span>
   							{% endif %}
							<span class="pagination-next">
							{% if single_page.has_next %}<a href="/washtub/pool/{{active_host}}/songs/{{single_page.next_page_number}}">next</a>&rarr;{% endif %}
   							</span>
  						 </div>
			      	  {% endblock pooltab %}
				</div>
			    <div id="tabs-4">
					  {% for name, entries in history.items %}
					  	<b>History Detail({{ name|replacedot }}):</b><br/>
					  	<table id="historyTable{{ forloop.counter0 }}" class="tablesorter"> 
						<thead> 
						<tr> 
						    <th class="pos">#</th> 
						    <th class="title">Title</th> 
						    <th class="artist">Artist</th> 
						    <th class="album">Album</th> 
						    <th class="status">Status</th>
						    <th class="onair">On Air</th>
						    <th class="rid">RID</th> 
						</tr>
			      	  	</thead>
			      	  	<tbody>
					  	{% for e in entries reversed%}
					  		{% for rid, listing in metadata_storage.items %}
					  			{% ifequal e rid %}
					  				<tr>
					  					<td class="pos">{{ forloop.parentloop.counter }}</td>
					  					<td>{{ listing.title|truncatewords:8 }}</td>
					  					<td>{{ listing.artist }}</td>
					  					<td>{{ listing.album|truncatewords:5 }}</td>
					  					<td>{{ listing.status }}</td>
					  					{% if listing.on_air %}
					  						<td>{{ listing.on_air }} {% now "T" %}</td>
					  					{% else %}
					  						<td></td>
					  					{% endif %}
					  					<td class="rid">{{ listing.rid }}</td>
					  				</tr>
					  			{% endifequal %}
			      	  	  	{% endfor %}
			      	  	{% endfor %}
			      	  	</tbody>
			      	  	</table>
			      	  	<br/>
					  {% endfor %}
				</div>
			    <div id="tabs-5">
			      	  <b>Available Commands:</b><br/>
			      	  <div class="help">
					  {% for item in help %}
					    	{{item}}<br/>
					  {% endfor %}
					  </div>
				</div>
			</div>
{% comment %}
<div id="accordion">
  <div>
	<h3><a href="#">Server Tools</a></h3>
		<div>
		    Tools.
		</div>
  </div>
  <div>
	<h3><a href="#">Second</a></h3>
		<div>Phasellus mattis tincidunt nibh.</div>
  </div>

  <div>
	<h3><a href="#">Third</a></h3>
		<div>Nam dui erat, auctor a, dignissim quis.</div>
	</div>
</div>
{% endcomment %}
{% endblock content %}